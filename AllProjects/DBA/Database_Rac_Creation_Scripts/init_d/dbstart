:
#
# $Header: dbstart 29-jul-2002.10:58:00 kmothuku Exp $ dbstart Copyr (c) 1991 Leapstone
#

###################################
# 
# usage: dbstart
#
# This script is used to start ORACLE from /etc/rc(.local).
# It should ONLY be executed as part of the system boot procedure.
#
#####################################

Usage()
{
   echo "" >&2
   echo "Usage:  dbstart <INSTANCE_NUMBER> <OPERATION_START_STOP>" >&2
#   echo "Usage:  dbstart 1 start"
#   echo "Usage:  dbstart 1 stop"
   echo ""
   echo "          <INSTANCE_NUMBER> - Oracle RAC Instance Number"
   echo "          <OPERATION_START_STOP> - Instance Startup or Shutdown"
   echo ""
   exit 1
}

#
# check usage
#
if [ $# != "2" ];then
  Usage;exit 1
fi


# set ORACLE environment
INSTANCE_NUMBER=$1; export INSTANCE_NUMBER
OPERATION_START_STOP=$2; export OPERATION_START_STOP

ORATAB=/var/opt/oracle/oratab

trap 'exit' 1 2 3
case $ORACLE_TRACE in
    T) set -x ;;
esac
    
# Set path if path not set (if called from /etc/rc)
case $PATH in
    "") PATH=/bin:/usr/bin:/etc
        export PATH ;;
esac
# Save LD_LIBRARY_PATH
SAVE_LLP=$LD_LIBRARY_PATH

# Start GSD
if [ $OPERATION_START_STOP = "start" ];then
   gsdctl start
   sleep 30
fi

#
# Loop for every entry in oratab file and and try to start
# that ORACLE
#


cat $ORATAB | while read LINE
do
    case $LINE in
        \#*)                ;;        #comment-line in oratab
        *)
#       Proceed only if third field is 'Y'.
        if [ "`echo $LINE | awk -F: '{print $3}' -`" = "Y" ] ; then
            ORACLE_SID=`echo $LINE | awk -F: '{print $1}' -`
            if [ "$ORACLE_SID" = '*' ] ; then
                ORACLE_SID=""
            fi
#           Called programs use same database ID
            export ORACLE_SID
            ORACLE_HOME=`echo $LINE | awk -F: '{print $2}' -`
#           Called scripts use same home directory
            export ORACLE_HOME
#           Put $ORACLE_HOME/bin into PATH and export.
            PATH=$ORACLE_HOME/bin:/bin:/usr/bin:/etc ; export PATH
#           add for bug # 652997
            LD_LIBRARY_PATH=${SAVE_LLP}:${ORACLE_HOME}/lib ; export LD_LIBRARY_PATH
            PFILE=${ORACLE_HOME}/dbs/init${ORACLE_SID}.ora


              if [ $OPERATION_START_STOP = "start" ];then
                 srvctl start instance -d  ${ORACLE_SID} -i ${ORACLE_SID}${INSTANCE_NUMBER}
              elif [ $OPERATION_START_STOP = "stop" ];then
                   srvctl stop instance -d  ${ORACLE_SID} -i ${ORACLE_SID}${INSTANCE_NUMBER}
              fi

        fi
        ;;
    esac
done
